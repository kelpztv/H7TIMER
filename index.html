<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>H7 Alliance Boss Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg-main:#2b1208;
  --green:#16a34a;
  --red:#991b1b;
}

body{
  margin:0;
  font-family:Arial,sans-serif;
  color:#f1f5f9;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),
    url("images/h7.png") center/cover no-repeat,
    var(--bg-main);
}

header{
  background:linear-gradient(to right,#4a0f0f,#7a1d14);
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h1{
  font-size:16px;
  margin:0;
}

button{
  background:#2563eb;
  border:none;
  color:#fff;
  padding:5px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:rgba(0,0,0,.65);
}

th,td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.08);
  vertical-align:middle;
}

th{
  color:#fde68a;
  font-size:13px;
}

td{
  font-size:13px;
}

.boss-cell{
  display:flex;
  align-items:center;
  gap:10px;
}

.boss-img{
  width:36px;
  height:36px;
  border-radius:6px;
  object-fit:cover;
  background:#000;
}

.spawned{
  background:var(--green);
  padding:4px 10px;
  border-radius:6px;
  font-weight:bold;
}

.countdown{
  background:var(--red);
  padding:4px 10px;
  border-radius:6px;
  font-weight:bold;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal-content{
  background:#1f2933;
  padding:20px;
  border-radius:8px;
  width:260px;
}

.modal-content h3{
  margin-top:0;
}

.modal-content input{
  width:100%;
  margin-bottom:10px;
  padding:6px;
}

@media(max-width:650px){
  th:nth-child(1),td:nth-child(1),
  th:nth-child(3),td:nth-child(3){
    display:none;
  }
}
</style>
</head>

<body>

<header>
  <h1>H7 ALLIANCE – BOSS SPAWN TIMER (LOCAL TIME)</h1>
  <button onclick="adminLogin()">Admin</button>
</header>

<table>
<thead>
<tr>
  <th>LV</th>
  <th>BOSS</th>
  <th>DAY</th>
  <th>SPAWN TIME</th>
  <th>STATUS</th>
  <th>ACTION</th>
</tr>
</thead>
<tbody id="bossTable"></tbody>
</table>

<!-- Death Time Modal -->
<div class="modal" id="deathModal">
  <div class="modal-content">
    <h3>Set Boss Death Time</h3>
    <input type="date" id="deathDate">
    <input type="time" id="deathTime">
    <button onclick="confirmDeath()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
const ADMIN_USER="legendweapon";
const ADMIN_PASS="legendweapon";
let isAdmin=localStorage.getItem("admin")==="1";
let cachedOrder=null;
let activeBossIndex=null;

const bosses=[
 {lv:60,name:"Venatus",img:"venatus.png",interval:10},
 {lv:65,name:"Viorent",img:"viorent.png",interval:10},
 {lv:70,name:"Ego",img:"ego.png",interval:21},
 {lv:75,name:"Clemantis",img:"clemantis.png",fixed:[[1,"13:30"],[4,"21:00"]]},
 {lv:75,name:"Livera",img:"livera.png",interval:24},
 {lv:80,name:"Araneo",img:"araneo.png",interval:24},
 {lv:80,name:"Undomiel",img:"undomiel.png",interval:24},
 {lv:82,name:"Saphirus",img:"saphirus.png",fixed:[[0,"19:00"],[2,"13:30"]]},
 {lv:80,name:"Neutro",img:"neutro.png",fixed:[[2,"21:00"],[4,"13:30"]]},
 {lv:85,name:"Lady Dalia",img:"ladydalia.png",interval:18},
 {lv:85,name:"General Aquleus",img:"generalaquelus.png",interval:29},
 {lv:86,name:"Thymele",img:"thymele.png",fixed:[[1,"21:00"],[3,"13:30"]]},
 {lv:88,name:"Amentis",img:"amentis.png",interval:29},
 {lv:88,name:"Baron Braudmore",img:"baronbraudmore.png",interval:32},
 {lv:90,name:"Milavy",img:"milavy.png",fixed:[[6,"17:00"]]},
 {lv:92,name:"Wannitas",img:"wannitas.png",interval:48},
 {lv:93,name:"Metus",img:"metus.png",interval:48},
 {lv:94,name:"Duplican",img:"duplican.png",interval:48},
 {lv:95,name:"Shulliar",img:"shulliar.png",interval:35},
 {lv:96,name:"Ringor",img:"ringor.png",fixed:[[6,"19:00"]]},
 {lv:97,name:"Roderick",img:"roderick.png",fixed:[[5,"21:00"]]},
 {lv:98,name:"Gareth",img:"gareth.png",interval:32},
 {lv:98,name:"Titore",img:"titore.png",interval:37},
 {lv:98,name:"Larba",img:"larba.png",interval:35},
 {lv:100,name:"Catena",img:"catena.png",interval:35},
 {lv:100,name:"Auraq",img:"auraq.png",fixed:[[6,"00:00"],[3,"23:00"]]},
 {lv:100,name:"Secreta",img:"secreta.png",interval:62},
 {lv:100,name:"Ordo",img:"ordo.png",interval:62},
 {lv:100,name:"Asta",img:"asta.png",interval:62},
 {lv:100,name:"Supore",img:"supore.png",interval:62},
 {lv:120,name:"Chaiflock",img:"chaiflock.png",fixed:[[7,"00:00"]]},
 {lv:120,name:"Benji",img:"benji.png",fixed:[[0,"23:00"]]},
 {lv:135,name:"Icaruthia",img:"icaruthia.png",fixed:[[2,"23:00"],[5,"23:00"]]},
 {lv:135,name:"Motti",img:"motti.png",fixed:[[3,"21:00"],[6,"21:00"]]},
 {lv:140,name:"Nevaeh",img:"nevaeh.png",fixed:[[1,"00:00"]]},
 {lv:140,name:"Tumier",img:"tumier.png",fixed:[[0,"21:00"]]}
];

function adminLogin(){
  if(isAdmin){
    localStorage.removeItem("admin");
    isAdmin=false;
    render(true);
    return;
  }
  const u=prompt("Username");
  const p=prompt("Password");
  if(u===ADMIN_USER && p===ADMIN_PASS){
    localStorage.setItem("admin","1");
    isAdmin=true;
    render(true);
  }
}

function nextFixed(list, from=new Date()){
  let soon=null;
  list.forEach(([d,t])=>{
    const [h,m]=t.split(":");
    let x=new Date(from);
    x.setHours(h,m,0,0);
    x.setDate(x.getDate()+((7+d-x.getDay())%7));
    if(x<=from) x.setDate(x.getDate()+7);
    if(!soon||x<soon) soon=x;
  });
  return soon;
}

function getBossNext(i){
  const saved=localStorage.getItem("next_"+i);
  if(saved) return new Date(saved);
  const b=bosses[i];
  const next=b.interval
    ? new Date(Date.now()+b.interval*3600000)
    : nextFixed(b.fixed);
  localStorage.setItem("next_"+i,next.toISOString());
  return next;
}

function resetBoss(i){
  if(!isAdmin) return;
  localStorage.removeItem("next_"+i);
  cachedOrder=null;
  render(true);
}

function openDeathModal(i){
  activeBossIndex=i;
  document.getElementById("deathModal").style.display="flex";
}

function closeModal(){
  document.getElementById("deathModal").style.display="none";
}

function confirmDeath(){
  const d=document.getElementById("deathDate").value;
  const t=document.getElementById("deathTime").value;
  if(!d||!t) return;

  const death=new Date(`${d}T${t}`);
  const b=bosses[activeBossIndex];

  const next=b.interval
    ? new Date(death.getTime()+b.interval*3600000)
    : nextFixed(b.fixed, death);

  localStorage.setItem("next_"+activeBossIndex,next.toISOString());
  closeModal();
  cachedOrder=null;
  render(true);
}

function render(force=false){
  const now=new Date();
  const table=document.getElementById("bossTable");
  table.innerHTML="";

  let rows=bosses.map((b,i)=>{
    const next=getBossNext(i);
    return{b,i,next,diff:next-now,spawned:next<=now};
  });

  if(force||!cachedOrder){
    const spawned=rows.filter(r=>r.spawned);
    const upcoming=rows.filter(r=>!r.spawned).sort((a,b)=>a.next-b.next);
    cachedOrder=[...spawned,...upcoming].map(r=>r.i);
  }

  cachedOrder.forEach(i=>{
    const r=rows.find(x=>x.i===i);
    const h=Math.max(0,Math.floor(r.diff/3600000));
    const m=Math.max(0,Math.floor((r.diff%3600000)/60000));

    table.innerHTML+=`
<tr>
<td>${r.b.lv}</td>
<td class="boss-cell">
  <img class="boss-img" src="images/${r.b.img}" onerror="this.src='images/unknown.png'">
  ${r.b.name}
</td>
<td>${r.next.toLocaleDateString(undefined,{weekday:"short"})}</td>
<td>${r.next.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"})}</td>
<td>${r.spawned?'<div class="spawned">SPAWNED</div>':`<div class="countdown">${h}h ${m}m</div>`}</td>
<td>
${isAdmin?`
<button onclick="resetBoss(${r.i})">Reset</button>
<button onclick="openDeathModal(${r.i})">⏱</button>`:"-"}
</td>
</tr>`;
  });
}

setInterval(render,1000);
render(true);
</script>

</body>
</html>
